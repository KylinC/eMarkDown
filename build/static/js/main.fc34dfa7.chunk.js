(this["webpackJsonpmark-doc"]=this["webpackJsonpmark-doc"]||[]).push([[0],{25:function(e,t,n){e.exports=n(60)},30:function(e,t,n){},31:function(e,t,n){},44:function(e,t){},51:function(e,t,n){},52:function(e,t,n){},60:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),i=n(22),r=n.n(i),o=(n(30),n(16)),l=n(15),s=n(14),u=n(7),d=n(3),f=n(2),m=n(6),b=(n(31),n(32),n(23)),p=n.n(b),v=(n(46),n(13)),E=n.n(v),w=function(e){return Object.keys(e).map((function(t){return e[t]}))},g=function(e,t){for(var n=e;null!==n;){if(n.classList.contains(t))return n;n=n.parentNode}return!1},h=window.require("fs").promises,j=(window.require("path"),{readFile:function(e){return h.readFile(e,{encoding:"utf8"})},writeFile:function(e,t){return h.writeFile(e,t,{encoding:"utf8"})},renameFile:function(e,t){return h.rename(e,t)},deleteFile:function(e){return h.unlink(e)}}),O=n(5),y=function(e){var t=Object(a.useState)(!1),n=Object(f.a)(t,2),c=n[0],i=n[1],r=function(t){t.keyCode==e&&i(!0)},o=function(t){t.keyCode==e&&i(!1)};return Object(a.useEffect)((function(){return document.addEventListener("keydown",r),document.addEventListener("keyup",o),function(){document.removeEventListener("keydown",r),document.removeEventListener("keyup",o)}}),[]),c},k=window.require("electron").ipcRenderer,N=function(e){Object(a.useEffect)((function(){return Object.keys(e).forEach((function(t){k.on(t,e[t])})),function(){Object.keys(e).forEach((function(t){k.removeListener(t,e[t])}))}}))},S=function(e){var t=e.title,n=e.onFileSearch,i=Object(a.useState)(!1),r=Object(f.a)(i,2),o=r[0],l=r[1],s=Object(a.useState)(""),u=Object(f.a)(s,2),d=u[0],b=u[1],p=y(13),v=y(27),E=Object(a.useRef)(null),w=function(){l(!0)},g=function(){l(!1),b(""),n("")};return N({"search-file":w}),Object(a.useEffect)((function(){p&&o&&n(d),v&&o&&g()})),Object(a.useEffect)((function(){o&&E.current.focus()}),[o]),c.a.createElement("div",{className:"alert alert-primary mb-0"},!o&&c.a.createElement("div",{className:"d-flex justify-content-between align-items-center mb-0"},c.a.createElement("span",null,t),c.a.createElement("button",{type:"button",className:"icon-button",onClick:w},c.a.createElement(O.a,{size:"lg",title:"search",icon:m.c}))),o&&c.a.createElement("div",{className:"d-flex justify-content-between align-items-center mb-0"},c.a.createElement("input",{className:"form-control",value:d,ref:E,onChange:function(e){b(e.target.value)}}),c.a.createElement("button",{type:"button",className:"icon-button",onClick:g},c.a.createElement(O.a,{size:"lg",title:"close",icon:m.d}))))};S.defaultProps={title:"default"};var F=S,C=n(12),x=window.require("electron").remote,L=x.Menu,D=x.MenuItem,A=function(e,t,n){var c=Object(a.useRef)(null);return Object(a.useEffect)((function(){var n=new L;e.forEach((function(e){n.append(new D(e))}));var a=function(e){document.querySelector(t).contains(e.target)&&(c.current=e.target,n.popup({window:x.getCurrentWindow()}))};return window.addEventListener("contextmenu",a),function(){window.removeEventListener("contextmenu",a)}}),n),c},I=window.require("electron").remote,q=(I.Menu,I.MenuItem,function(e){var t=e.files,n=e.onFileClick,i=e.onSaveEdit,r=e.onFileDelete,o=Object(a.useState)(!1),l=Object(f.a)(o,2),s=l[0],u=l[1],d=Object(a.useState)(""),b=Object(f.a)(d,2),p=b[0],v=b[1],E=Object(a.useRef)(null),w=y(13),h=y(27),j=function(e){u(!1),v(""),e.isNew&&r(e.id)},k=A([{label:"Open",click:function(){var e=g(k.current,"file-item");e&&n(e.dataset.id)}},{label:"Rename",click:function(){var e=g(k.current,"file-item");if(e){var t=e.dataset,n=t.id,a=t.title;u(n),v(a)}}},{label:"Delete",click:function(){var e=g(k.current,"file-item");e&&r(e.dataset.id)}}],".file-list",[t]);return Object(a.useEffect)((function(){var e=t.find((function(e){return e.isNew}));e&&(u(e.id),v(e.title))}),[t]),Object(a.useEffect)((function(){s&&E.current.focus()}),[s]),Object(a.useEffect)((function(){var e=t.find((function(e){return e.id===s}));w&&s&&""!==p.trim()&&(i(e.id,p,e.isNew),u(!1),v("")),h&&s&&j(e)})),c.a.createElement("ul",{className:"list-group list-group-flush file-list"},t.map((function(e){return c.a.createElement("li",{className:"row list-group-item bg-light d-flex align-items-center file-item mx-0",key:e.id,"data-id":e.id,"data-title":e.title},e.id!=s&&!e.isNew&&c.a.createElement(c.a.Fragment,null,c.a.createElement("span",{className:"col-2"},c.a.createElement(O.a,{size:"lg",icon:C.a})),c.a.createElement("span",{className:"col-6 c-link",onClick:function(){n(e.id)}},e.title)),(e.id==s||e.isNew)&&c.a.createElement(c.a.Fragment,null,c.a.createElement("span",{className:"col-2"},c.a.createElement(O.a,{size:"lg",icon:C.a})),c.a.createElement("input",{className:"form-control col-8",value:p,ref:E,placeholder:"untitled",onChange:function(e){v(e.target.value)}}),c.a.createElement("button",{type:"button",className:"icon-button col-2",onClick:function(){j(e)}},c.a.createElement(O.a,{size:"lg",title:"close",icon:m.d}))))})))}),M=function(e){var t=e.text,n=e.colorClass,a=e.icon,i=e.onBtnClick;return c.a.createElement("button",{type:"button",className:"btn btn-block no-border ".concat(n),onClick:i},c.a.createElement(O.a,{className:"mr-2",size:"lg",icon:a}),t)};M.defaultProps={title:"New File"};var T=M,P=n(24),z=n.n(P),B=(n(51),function(e){var t=e.files,n=e.activeId,a=e.unsaveIds,i=e.onTabClick,r=e.onCloseTab;return c.a.createElement("ul",{className:"nav nav-pills tablist-component"},t.map((function(e){var t=a.includes(e.id),o=z()({"nav-link":!0,active:e.id==n,withUnsaved:t});return c.a.createElement("li",{className:"nav-item",key:e.id},c.a.createElement("a",{href:"#",className:o,onClick:function(t){t.preventDefault(),i(e.id)}},e.title,c.a.createElement("span",{className:"ml-2 close-icon",onClick:function(t){t.stopPropagation(),r(e.id)}},c.a.createElement(O.a,{icon:m.d})),t&&c.a.createElement("span",{className:"rounded-circle ml-2 unsaved-icon"})))})))});B.defaultProps={unsaveIds:[]};var R=B,W=(n(52),function(e){var t=e.text,n=void 0===t?"Waiting...":t;return c.a.createElement("div",{className:"loading-component text-center"},c.a.createElement("div",{className:"spinner-border text-primary",role:"status"},c.a.createElement("span",{className:"sr-only"},n)),c.a.createElement("h5",{className:"text-primary"},n))}),J=window.require("path"),K=J.join,H=J.basename,U=J.extname,$=J.dirname,G=window.require("electron"),Q=G.remote,V=G.ipcRenderer,X=window.require("electron-store"),Y=new X({name:"Files Data"}),Z=new X({name:"Settings"}),_=function(){return["accessKey","secretKey","bucketName","enableAutoSync"].every((function(e){return!!Z.get(e)}))},ee=function(e){var t=w(e).reduce((function(e,t){var n=t.id,a=t.path,c=t.title,i=t.createAt,r=t.isSynced,o=t.updatedAt;return e[n]={id:n,path:a,title:c,createAt:i,isSynced:r,updatedAt:o},e}),{});Y.set("files",t)};var te=function(){var e=Object(a.useState)(Y.get("files")||{}),t=Object(f.a)(e,2),n=t[0],i=t[1],r=Object(a.useState)(""),b=Object(f.a)(r,2),v=b[0],g=b[1],h=Object(a.useState)([]),O=Object(f.a)(h,2),y=O[0],k=O[1],S=Object(a.useState)([]),C=Object(f.a)(S,2),x=C[0],L=C[1],D=Object(a.useState)(!1),A=Object(f.a)(D,2),I=A[0],M=A[1],P=Object(a.useState)([]),z=Object(f.a)(P,2),B=z[0],J=z[1],G=y.map((function(e){return n[e]})),X=w(n),te=Z.get("savedFileLocation")||Q.app.getPath("documents"),ne=n[v],ae=B.length>0?B:X,ce=function(e){var t=y.filter((function(t){return t!=e}));k(t),t.length>0?g(t[0]):g("")},ie=function(){var e=E()(),t={id:e,title:"",body:"## Title",createAt:(new Date).getTime(),isNew:!0};i(Object(d.a)({},n,Object(u.a)({},e,t)))},re=function(){Q.dialog.showOpenDialog({title:"Open MarkDown File",properties:["openFile","multiSelections"],filters:[{name:"Markdown files",extensions:["md"]}]}).then((function(e){console.log(e.filePaths);var t=e.filePaths;if(Array.isArray(t)){var a=t.filter((function(e){return!Object.values(n).find((function(t){return t.path===e}))})).map((function(e){return{id:E()(),title:H(e,U(e)),path:e}})),c=Object(d.a)({},n,{},a.reduce((function(e,t){return e[t.id]=t,e}),{}));i(c),ee(c),a.length>0&&Q.dialog.showMessageBox({type:"info",title:"Successfully ".concat(a.length," File(s) Imported"),message:"Successfully ".concat(a.length," File(s) Imported")})}})).catch((function(e){console.log(e)}))};return N({"create-new-file":ie,"import-file":re,"save-edit-file":function(){var e=ne.path,t=(ne.body,ne.title);j.writeFile(ne.path,ne.body).then((function(){L(x.filter((function(e){return e!=ne.id}))),_()&&V.send("upload-file",{key:"".concat(t,".md"),path:e})}))},"active-file-uploaded":function(){var e=ne.id,t=Object(d.a)({},n[e],{isSynced:!0,updatedAt:(new Date).getTime()}),a=Object(d.a)({},n,Object(u.a)({},e,t));i(a),ee(a)},"file-downloaded":function(e,t){var a=n[t.id],c=a.id,r=a.path;j.readFile(r).then((function(e){var a;a="download-success"===t.status?Object(d.a)({},n[c],{body:e,isLoaded:!0,isSynced:!0,updatedAt:(new Date).getTime()}):Object(d.a)({},n[c],{body:e,isLoaded:!0});var r=Object(d.a)({},n,Object(u.a)({},c,a));i(r),ee(r)}))},"loading-status":function(e,t){M(t)}}),c.a.createElement("div",{className:"App container-fluid px-0"},c.a.createElement("div",{className:"row no-gutters"},c.a.createElement("div",{className:"col-3 bg-light left-panel"},c.a.createElement(F,{title:"Doc Files",onFileSearch:function(e){var t=X.filter((function(t){return t.title.includes(e)}));J(t)}}),c.a.createElement(q,{files:ae,onFileClick:function(e){g(e);var t=n[e],a=t.id,c=t.title,r=t.path;t.isLoaded;t.isLoaded||(_()?V.send("download-file",{key:"".concat(c,".md"),path:r,id:a}):j.readFile(t.path).then((function(t){var a=Object(d.a)({},n[e],{body:t,isLoaded:!0});i(Object(d.a)({},n,Object(u.a)({},e,a)))}))),y.includes(e)||k([].concat(Object(s.a)(y),[e]))},onFileDelete:function(e){if(n[e].isNew){n[e];var t=Object(o.a)(n,[e].map(l.a));i(t)}else j.deleteFile(K(te,"".concat(n[e].title,".md"))).then((function(){n[e];var t=Object(o.a)(n,[e].map(l.a));i(t),ee(t),ce(e)}))},onSaveEdit:function(e,t,a){var c=K(a?te:$(n[e].path),"".concat(t,".md")),r=Object(d.a)({},n[e],{title:t,isNew:!1,path:c}),o=Object(d.a)({},n,Object(u.a)({},e,r));if(a)j.writeFile(c,n[e].body).then((function(){i(o),ee(o)}));else{var l=n[e].path;j.renameFile(l,c).then((function(){i(o),ee(o)}))}}}),c.a.createElement("div",{className:"row no-gutters button-group"},c.a.createElement("div",{className:"col"},c.a.createElement(T,{text:"New File",colorClass:"btn-primary",icon:m.b,onBtnClick:ie})),c.a.createElement("div",{className:"col"},c.a.createElement(T,{text:"Import",colorClass:"btn-success",icon:m.a,onBtnClick:re})))),c.a.createElement("div",{className:"col-9 right-panel"},!ne&&c.a.createElement("div",{className:"start-page"},c.a.createElement("p",null),c.a.createElement("p",{align:"center"},"eMarkDown")),ne&&c.a.createElement(c.a.Fragment,null,c.a.createElement(R,{files:G,activeId:v,unsaveIds:x,onTabClick:function(e){g(e)},onCloseTab:ce}),c.a.createElement(p.a,{key:ne&&ne.id,value:ne&&ne.body,onChange:function(e){!function(e,t){if(t!==n[e].body){var a=Object(d.a)({},n[e],{body:t});i(Object(d.a)({},n,Object(u.a)({},e,a))),x.includes(e)||L([].concat(Object(s.a)(x),[e]))}}(ne.id,e)},options:{minHeight:"515px"}}),ne.isSynced&&c.a.createElement("span",{className:"sync-status"}," Sync,Last Sync: ",function(e){var t=new Date(e);return t.toLocaleDateString()+" "+t.toLocaleTimeString()}(ne.updatedAt))))),I&&c.a.createElement(W,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(te,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[25,1,2]]]);
//# sourceMappingURL=main.fc34dfa7.chunk.js.map